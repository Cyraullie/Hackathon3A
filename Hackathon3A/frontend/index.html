<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  	<link rel="stylesheet" href="./src/style.css">
  	<link rel="stylesheet" href="./src/windows.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hackathon team 3A</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/start.ts"></script>
      <form>
  
      <button id="get">Start</button>
     

    </form>
	
    <div id="output"></div>
    <div class="overlay" id="popupOverlay">
    <div class="popup">
      <div class="popup-header">
        <span>Leaderboard</span>
        <button id="closePopup">X</button>
      </div>
      <div style="margin-bottom: 10px;">
                
                <input type="text" id="input"/>
              <button id="post">Post</button>
              </div>
      <div class="popup-content" id="popupContent">
      
      </div>
    </div>
  </div>
    <script>
const url = "http://localhost:3000";
const getBtn = document.getElementById("get");
const postBtn = document.getElementById("post");
const input = document.getElementById("input");
const popupOverlay = document.getElementById("popupOverlay");
const popupContent = document.getElementById("popupContent");
const closePopup = document.getElementById("closePopup");

// üî¥ Close popup
closePopup.addEventListener("click", () => {
  popupOverlay.style.display = "none";
});

// üü¢ Load leaderboard
async function loadLeaderboard() {
  popupOverlay.style.display = "flex";
  popupContent.innerHTML = "<p>Loading leaderboard...</p>";

  try {
    const res = await fetch(url + "/connexion", {
      method: "GET",
      headers: { "Content-Type": "application/json" },
    });

    if (!res.ok) throw new Error("Server returned " + res.status);

    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      popupContent.innerHTML = `
        <p style="text-align:center; color:gray;">
          üïπÔ∏è No users found yet.<br>Be the first to post a score!
        </p>
      `;
    } else {
      data.sort((a, b) => b.score - a.score);
      popupContent.innerHTML = `
        ${data
          .map((u, i) => `<div>${i + 1}. <b>${u.name}</b> ‚Äî ${u.score}</div>`)
          .join("")}
      `;
    }
  } catch (err) {
    console.error(err);
    popupContent.innerHTML = `
      <p style="color:red; text-align:center;">
        ‚ö†Ô∏è Could not load leaderboard.<br>
        Make sure the backend is running.
      </p>
    `;
  }
}

// üîò GET button
getBtn.addEventListener("click", (e) => {
  e.preventDefault();
  loadLeaderboard();
});

// üü° POST button
postBtn.addEventListener("click", async (e) => {
  e.preventDefault();

  const name = input.value.trim();
  if (!name) return alert("Please enter a name");

  const score = Math.floor(Math.random() * 100);

  try {
    const res = await fetch(url + "/info", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, score }),
    });

    const data = await res.json();

    if (res.ok) {
      alert(`‚úÖ Saved ${data.name} with score ${data.score}`);
      input.value = "";
      loadLeaderboard(); // Refresh leaderboard after saving
    } else {
      alert("‚ùå Error: " + (data.error || "Unknown error"));
    }
  } catch (err) {
    console.error(err);
    alert("‚ùå Failed to send data to server");
  }
});
</script>
  </body>
</html>